webpackJsonp([1],{EJCV:function(t,e){t.exports={ROOT:"http://localhost:8080/tree",ROOT_DEV:"http://localhost:8080"}},HtWr:function(t,e){},IYLo:function(t,e){},N2to:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("7+uW"),r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("header",{attrs:{id:""}},[e("div",[e("router-link",{attrs:{to:"/"}},[this._v("VAVE TECH 树径测量")])],1),this._v(" "),e("div",{staticClass:"navs"},[e("router-link",{attrs:{to:"/"}},[this._v("测量记录")]),this._v(" "),e("router-link",{attrs:{to:"/tree"}},[this._v("树木成长记录")])],1)]),this._v(" "),e("div",{staticClass:"router-outer"},[e("router-view")],1)])},staticRenderFns:[]};var n=a("VU/8")({name:"App"},r,!1,function(t){a("jn11")},null,null).exports,s=a("/ocq"),o=a("woOf"),l=a.n(o),d=a("fZjL"),c=a.n(d),u=a("EJCV"),p=a.n(u),h={data:function(){return{conf:p.a,editMode:!1,editDots:[],dialogVisible:!1,picPath:"",detail:{}}},computed:{detail_time:function(){return this.detail.time?this.detail.time.slice(0,10):""},detail_way:function(){return"自动"},diameter:function(){return this.detail.diameterCorrect?this.detail.diameterCorrect:this.detail.diameterCalculate},line1_style:function(){var t={left:"0",top:"0"};if(this.detail&&this.detail.dotsCalculate&&this.detail.dotsCalculate.leftx){var e=this.detail.dotsCorrect?this.detail.dotsCorrect:this.dotsCalculate;t={left:(1*e.leftx/3e3*400-2).toString()+"px",top:(1*e.lefty/4e3*533-50).toString()+"px",transform:"rotate("+e.anglel+"deg)"}}return"-"==t.top.charAt(0)&&(t.top="213.2px"),t},line2_style:function(){var t={left:"0",top:"0"};if(this.detail&&this.detail.dotsCalculate&&this.detail.dotsCalculate.rightx){var e=this.detail.dotsCorrect?this.detail.dotsCorrect:this.dotsCalculate;t={left:(1*e.rightx/3e3*400).toString()+"px",top:(1*e.righty/4e3*533-50).toString()+"px",transform:"rotate("+e.angler+"deg)"}}return"-"==t.top.charAt(0)&&(t.top="213.2px"),t}},props:{tableData:Array},methods:{showPic:function(t){this.picPath="",this.picPath=p.a.ROOT+t.path,this.detail=t,this.dialogVisible=!0,console.log(t)},getDotsStyle:function(t){this.editDots[t].left,this.editDots[t].left},editClick:function(t){this.editDots.length<4?this.editDots.push({x:t.offsetX,y:t.offsetY}):this.$message({message:"请用四个点标注树干位置，标注错误请撤销",type:"warning"})},saveEdit:function(){var t=this;if(4==this.editDots.length){var e=this.editDots.map(function(t){return{x:Math.round(3e3*t.x/400),y:Math.round(4e3*t.y/533.33)}});if(e.sort(function(t,e){return t.x-e.x}),e[0].y>e[1].y){var a=e[0];e[0]=e[1],e[1]=a}if(e[2].y>e[3].y){var i=e[2];e[2]=e[3],e[3]=i}var r=this,n=[];n.push(e[0].x),n.push(e[0].y),n.push(e[1].x),n.push(e[1].y),n.push(e[2].x),n.push(e[2].y),n.push(e[3].x),n.push(e[3].y),n.push(this.detail.dotsCalculate.upx),n.push(this.detail.dotsCalculate.upy),n.push(this.detail.dotsCalculate.downx),n.push(this.detail.dotsCalculate.downy);var s={id:r.detail.id,pic:r.detail.pic,left_up_x:e[0].x,left_up_y:e[0].y,left_down_x:e[1].x,left_down_y:e[1].y,right_up_x:e[2].x,right_up_y:e[2].y,right_down_x:e[3].x,right_down_y:e[3].y,dots:n};console.log(s);var o=c()(s).map(function(t){return t+"="+s[t]}).join("&");fetch(p.a.ROOT+"/api/measurements?"+o,{method:"PATCH"}).then(function(t){return t.json()}).then(function(e){if(e.data.success){r.detail.diameterCorrect=e.data.diameter_correct,r.editMode=!1;var a={};l()(a,r.detail.dotsCalculate),console.log(a),l()(a,e.data.dots),console.log(a),r.detail.dotsCorrect=a,t.editDots=[],r.$message({message:"标注成功",type:"success"})}})}else this.$message({message:"请用四个点标注树干位置",type:"warning"})}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[a("el-table-column",{attrs:{prop:"time",label:"测量日期",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"treeCode",label:"树木编码",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("router-link",{attrs:{to:{name:"tree",params:{treeCode:e.row.treeCode}}}},[a("el-button",{attrs:{type:"text",size:"small"}},[t._v(t._s(e.row.treeCode))])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"diameterCalculate",label:"测量结果(cm)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.diameterCorrect?e.row.diameterCorrect:e.row.diameterCalculate))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"测量方式"}}),t._v(" "),a("el-table-column",{attrs:{label:"查看详情"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.showPic(e.row)}}},[t._v("查看")])]}}])})],1),t._v(" "),a("el-dialog",{attrs:{title:"照片查看",visible:t.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"dialog-content"},[a("div",{staticClass:"image-wrapper"},[a("img",{attrs:{src:t.conf.ROOT+t.detail.pic}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.editMode,expression:"!editMode"}],staticClass:"line line1",style:t.line1_style}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.editMode,expression:"!editMode"}],staticClass:"line line2",style:t.line2_style}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.editMode,expression:"editMode"}],staticClass:"edit-wrapper",on:{click:t.editClick}},t._l(t.editDots,function(t,e){return a("div",{key:e,staticClass:"edit-dot",style:{left:t.x+"px",top:t.y+"px"}})}))]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.editMode,expression:"!editMode"}],staticClass:"info-wrapper"},[a("p",[t._v("测量日期："+t._s(t.detail.time))]),t._v(" "),a("p",[t._v("树木编码："+t._s(t.detail.treeCode))]),t._v(" "),a("p",[t._v("测量结果(cm)："+t._s(t.diameter))]),t._v(" "),a("p",[t._v("测量方式："+t._s(t.detail.type))]),t._v(" "),a("el-button",{attrs:{plain:""},on:{click:function(e){t.editMode=!0}}},[t._v("人工标注")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.editMode,expression:"editMode"}],staticClass:"info-wrapper btn-wrapper"},[a("div",{staticClass:"btn-row"},[a("el-button",{attrs:{plain:""},on:{click:function(e){t.editDots=[]}}},[t._v("撤销所有")])],1),t._v(" "),a("div",{staticClass:"btn-row"},[a("el-button",{attrs:{plain:""},on:{click:t.saveEdit}},[t._v("保存更改")]),t._v(" "),a("el-button",{attrs:{plain:""},on:{click:function(e){t.editMode=!1,this.editDots=[]}}},[t._v("放弃退出")])],1)])])])],1)},staticRenderFns:[]};var m=a("VU/8")(h,f,!1,function(t){a("HtWr")},null,null).exports,v={components:{"z-table":m},data:function(){return{picPath:"",msg:"Welcome to Your Vue.js App",dateRange:"",detail:{},tableData:[{time:"2016-05-02",treeCode:"tree111",diameterCalculate:11.1,pic:"../assets/tree.jpg",thumbnail:a("yFUI"),way:"自动",dots:{leftX:"1796",leftY:"1698",upX:"1646",upY:"177",rightX:"1888",rightY:"177",downX:"1789",downY:"2248"}},{time:"2016-05-04",treeCode:"tree1111",diameterCalculate:12.2,pic:"../assets/tree.jpg",thumbnail:"../assets/thumbnail.png",way:"自动",dots:{leftX:"1796",leftY:"1698",upX:"1646",upY:"177",rightX:"1888",rightY:"177",downX:"1789",downY:"2248"}},{time:"2016-05-01",treeCode:"tree111",diameterCalculate:12.5,pic:"pic path",thumbnail:"/assets/thumbnail.png",way:"自动",dots:{leftX:"1796",leftY:"1698",upX:"1646",upY:"177",rightX:"1888",rightY:"177",downX:"1789",downY:"2248"}},{time:"2016-05-03",treeCode:"tree111",diameterCalculate:13.1,pic:"pic path",thumbnail:"/assets/thumbnail.png",way:"自动",dots:{leftX:"1796",leftY:"1698",upX:"1646",upY:"177",rightX:"1888",rightY:"177",downX:"1789",downY:"2248"}}]}},mounted:function(){var t=this;fetch(p.a.ROOT+"/api/measurements").then(function(t){return t.json()}).then(function(e){t.tableData=e.data})},methods:{search:function(){var t=this.dateRange,e=this;fetch(p.a.ROOT+"/api/measurements?beginDate="+t[0]+"&endDate="+t[1]).then(function(t){return t.json()}).then(function(t){e.tableData=t.data})}}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hello"},[a("div",{staticClass:"search-box"},[a("el-row",[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),a("z-table",{attrs:{tableData:t.tableData}})],1)])},staticRenderFns:[]};var C=a("VU/8")(v,_,!1,function(t){a("uWLq")},"data-v-18ec26f2",null).exports,g={components:{"z-table":m},data:function(){return{myChart:null,treeCode:"",tableData:[],treeInfo:{measureTimes:0,grow:0}}},mounted:function(){var t=this.$route.params.treeCode||"";this.treeCode=t,this.initChart(),t&&""!=t&&this.fetchData(t)},methods:{showPic:function(t,e,a){console.log("showPic")},search:function(){this.fetchData(this.treeCode)},fetchData:function(t){var e=this;fetch(p.a.ROOT+"/api/measurements?treeCode="+t).then(function(t){return t.json()}).then(function(t){e.tableData=t.data;var a=[],i=[];t.data.forEach(function(t){a.push(t.time.split(" ")[0]),i.push(t.diameterCalculate)}),a=a.reverse(),i=i.reverse();for(var r=1;r<a.length;r++)a[r-1]==a[r]&&(a.splice(r-1,1),i.splice(r-1,1),r--);e.treeInfo.measureTimes=a.length,e.tableData=t.data,e.updateChart(a,i)}),fetch(p.a.ROOT+"/api/trees/"+t).then(function(t){return t.json()}).then(function(t){e.treeInfo.grow=t.data.grow})},updateChart:function(t,e){this.myChart.setOption({grid:{left:"0%",right:"4%",containLabel:!0},tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,axisLine:{onZero:!1},data:t},yAxis:{},series:[{name:"直径",type:"line",data:e,label:{normal:{show:!0,position:"top"}}}]})},initChart:function(){var t=this,e=this.$echarts.init(document.getElementById("chart"),"macarons");e.on("click",function(e){t.showPic(e.dataIndex,e.data,e.name)}),t.myChart=e}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入树木编码"},model:{value:t.treeCode,callback:function(e){t.treeCode=e},expression:"treeCode"}}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),a("el-row",{staticClass:"info"},[a("span",[t._v("树种：未知")]),t._v(" "),a("span",[t._v("测量次数："+t._s(t.treeInfo.measureTimes))]),t._v(" "),a("span",[t._v("生长速度："+t._s(t.treeInfo.grow)+" cm/年")])]),t._v(" "),a("div",{attrs:{id:"chart"}}),t._v(" "),a("z-table",{attrs:{tableData:t.tableData}})],1)},staticRenderFns:[]};var y=a("VU/8")(g,w,!1,function(t){a("N2to")},null,null).exports,b={data:function(){return{tableData:[{treeCode:"tree1111",treeType:"未知",measureTimes:10,grow:12.1},{treeCode:"tree1111",treeType:"未知",measureTimes:10,grow:12.1}]}},mounted:function(){var t=this;fetch(p.a.ROOT+"/api/trees").then(function(t){return t.json()}).then(function(e){t.tableData=e.data})}},x={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[a("el-table-column",{attrs:{prop:"treeCode",label:"树木编码"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("router-link",{attrs:{to:{name:"tree",params:{treeCode:e.row.treeCode}}}},[a("el-button",{attrs:{type:"text",size:"small"}},[t._v(t._s(e.row.treeCode))])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"treeType",label:"树木种类"}}),t._v(" "),a("el-table-column",{attrs:{prop:"measureTimes",label:"测量次数"}}),t._v(" "),a("el-table-column",{attrs:{prop:"grow",label:"生长速度(cm/年)"}})],1)],1)],1)},staticRenderFns:[]};var D=a("VU/8")(b,x,!1,function(t){a("iCUt")},null,null).exports;i.default.use(s.a);var k=new s.a({routes:[{path:"/",name:"HelloWorld",component:C},{path:"/tree",name:"trees",component:D},{path:"/tree/:treeCode",name:"tree",component:y}]}),O=a("zL8q"),R=a.n(O),T=(a("tvR6"),a("IYLo"),a("XLwt")),Y=a.n(T);a("tcAE");i.default.config.productionTip=!1,i.default.use(R.a),i.default.prototype.$echarts=Y.a,new i.default({el:"#app",router:k,components:{App:n},template:"<App/>"})},iCUt:function(t,e){},jn11:function(t,e){},tvR6:function(t,e){},uWLq:function(t,e){},yFUI:function(t,e,a){t.exports=a.p+"tree/img/thumbnail.320f0f9.png"}},["NHnr"]);
//# sourceMappingURL=app.b71a2635da678f07b8ab.js.map